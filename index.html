<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wilderness Journey - Depths to Heights</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #e8f0f2 0%, #d4e4e8 100%);
            color: #2c3e50;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .screen {
            display: none;
            animation: fadeIn 1s ease-in;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .screen.active {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Header Styles */
        .header {
            text-align: center;
            padding: 30px 20px;
            background: linear-gradient(135deg, #6b8e9f 0%, #8fa7b3 100%);
            color: white;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            font-weight: normal;
        }

        .header p {
            font-size: 16px;
            opacity: 0.95;
            line-height: 1.6;
        }

        /* Hook Screen */
        .hook-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 40px 20px;
        }

        .hook-text {
            font-size: 24px;
            color: #4a6572;
            line-height: 1.8;
            margin-bottom: 40px;
            font-style: italic;
        }

        .hook-verse {
            font-size: 18px;
            color: #6b8e9f;
            margin-bottom: 40px;
            padding: 20px;
            background: rgba(255,255,255,0.5);
            border-radius: 10px;
        }

        /* Button Styles */
        .btn {
            background: linear-gradient(135deg, #7c9885 0%, #8fa49a 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            font-family: 'Georgia', serif;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.25);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #94a5ab 0%, #a8b7bc 100%);
            padding: 12px 24px;
            font-size: 16px;
            margin: 10px;
        }

        /* Mood Tracker */
        .mood-section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .mood-section h2 {
            color: #4a6572;
            margin-bottom: 20px;
            font-size: 22px;
            font-weight: normal;
        }

        .mood-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .mood-btn {
            padding: 20px;
            background: linear-gradient(135deg, #f7f9fa 0%, #e8eff1 100%);
            border: 2px solid transparent;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .mood-btn:hover {
            border-color: #8fa7b3;
            transform: translateY(-2px);
        }

        .mood-btn.selected {
            background: linear-gradient(135deg, #8fa7b3 0%, #a2b8c2 100%);
            color: white;
            border-color: #6b8e9f;
        }

        .mood-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .mood-label {
            font-size: 14px;
            font-weight: 500;
        }

        /* Psalm Display */
        .psalm-display {
            background: linear-gradient(135deg, #f8fbf8 0%, #eef4ee 100%);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            border-left: 4px solid #7c9885;
        }

        .psalm-display h3 {
            color: #4a6572;
            margin-bottom: 15px;
            font-size: 20px;
        }

        .psalm-text {
            font-size: 18px;
            line-height: 1.8;
            color: #5a6c75;
            font-style: italic;
        }

        .psalm-reference {
            text-align: right;
            color: #7c9885;
            margin-top: 15px;
            font-size: 16px;
        }

        /* Wilderness Stories */
        .story-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .story-card:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .story-card h3 {
            color: #4a6572;
            margin-bottom: 10px;
            font-size: 20px;
        }

        .story-card p {
            color: #6b8e9f;
            line-height: 1.6;
        }

        .story-expanded {
            background: linear-gradient(135deg, #f0f7f2 0%, #e6f2e9 100%);
            padding: 20px;
            border-radius: 10px;
            margin-top: 10px;
            display: none;
            color: #4a6572;
            line-height: 1.8;
        }

        .story-expanded.active {
            display: block;
        }

        /* Spiritual Disciplines */
        .discipline-item {
            background: linear-gradient(135deg, #fafbfc 0%, #f0f4f5 100%);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            border-left: 3px solid #8fa7b3;
        }

        .discipline-item h4 {
            color: #4a6572;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .discipline-item p {
            color: #6b8e9f;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .discipline-practice {
            background: white;
            padding: 15px;
            border-radius: 8px;
            font-style: italic;
            color: #5a6c75;
        }

        /* Journal Section */
        .journal-area {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            border: 2px solid #d4e4e8;
            border-radius: 10px;
            font-family: 'Georgia', serif;
            font-size: 16px;
            line-height: 1.6;
            resize: vertical;
            background: white;
            color: #4a6572;
        }

        .journal-area:focus {
            outline: none;
            border-color: #8fa7b3;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #6b8e9f 0%, #8fa7b3 100%);
            padding: 15px;
            display: flex;
            justify-content: space-around;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        .nav-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Georgia', serif;
            font-size: 14px;
        }

        .nav-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        /* Info Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 2000;
            padding: 20px;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal h2 {
            color: #4a6572;
            font-size: 24px;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 28px;
            color: #6b8e9f;
            cursor: pointer;
        }

        .info-section {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e8eff1;
        }

        .info-section:last-child {
            border-bottom: none;
        }

        .info-section h3 {
            color: #4a6572;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .info-section p, .info-section ul {
            color: #6b8e9f;
            line-height: 1.6;
        }

        .info-section ul {
            padding-left: 20px;
        }

        .crisis-note {
            background: #fff4e6;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #ff9800;
            margin: 20px 0;
        }

        .crisis-note strong {
            color: #e65100;
        }

        .donation-section {
            background: linear-gradient(135deg, #f0f7f2 0%, #e6f2e9 100%);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-top: 20px;
        }

        .donation-btn {
            background: linear-gradient(135deg, #7c9885 0%, #8fa49a 100%);
            color: white;
            padding: 12px 25px;
            border-radius: 20px;
            text-decoration: none;
            display: inline-block;
            margin-top: 10px;
            transition: all 0.3s ease;
        }

        .donation-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        /* Audio Controls */
        .audio-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.9);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1001;
            transition: all 0.3s ease;
        }

        .audio-toggle:hover {
            transform: scale(1.1);
        }

        .audio-toggle.muted {
            background: rgba(200,200,200,0.9);
        }

        /* Responsive Design */
        @media (max-width: 480px) {
            .header h1 {
                font-size: 24px;
            }
            
            .hook-text {
                font-size: 20px;
            }
            
            .mood-options {
                grid-template-columns: 1fr;
            }
            
            .bottom-nav {
                padding: 10px;
            }
            
            .nav-btn {
                padding: 8px 15px;
                font-size: 12px;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(139,167,179,0.3);
            border-radius: 50%;
            border-top-color: #8fa7b3;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Content Sections */
        .content-section {
            flex: 1;
            padding-bottom: 80px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <!-- Audio Toggle -->
    <div class="audio-toggle" id="audioToggle" onclick="toggleAudio()">
        <span id="audioIcon">🔊</span>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Hook Screen -->
        <div class="screen active" id="hookScreen">
            <div class="hook-screen">
                <div class="hook-text">
                    "Have you ever felt like God has led you into a wilderness?"
                </div>
                <div class="hook-verse">
                    "He knows the way that I take;<br>
                    when He has tested me,<br>
                    I will come forth as gold."<br>
                    <small>- Job 23:10</small>
                </div>
                <button class="btn" onclick="startJourney()">Begin Your Journey</button>
            </div>
        </div>

        <!-- Main Menu -->
        <div class="screen" id="mainMenu">
            <div class="header">
                <h1>Wilderness Journey</h1>
                <p>A companion through spiritual valleys toward hope</p>
            </div>
            
            <div class="content-section">
                <div class="mood-section">
                    <h2>Where are you today?</h2>
                    <div class="mood-options">
                        <div class="mood-btn" onclick="selectMood('darkness', this)">
                            <div class="mood-icon">🌑</div>
                            <div class="mood-label">In Deep Darkness</div>
                        </div>
                        <div class="mood-btn" onclick="selectMood('lost', this)">
                            <div class="mood-icon">🌫️</div>
                            <div class="mood-label">Lost & Confused</div>
                        </div>
                        <div class="mood-btn" onclick="selectMood('weary', this)">
                            <div class="mood-icon">😔</div>
                            <div class="mood-label">Weary & Exhausted</div>
                        </div>
                        <div class="mood-btn" onclick="selectMood('numb', this)">
                            <div class="mood-icon">🫥</div>
                            <div class="mood-label">Numb & Empty</div>
                        </div>
                    </div>
                    <button class="btn" onclick="showScreen('psalmTherapy')">Find Your Psalm</button>
                </div>

                <div class="mood-section">
                    <h2>Journey Options</h2>
                    <button class="btn-secondary" onclick="showScreen('wildernessStories')">Wilderness Stories</button>
                    <button class="btn-secondary" onclick="showScreen('simpleDisciplines')">When Faith Feels Impossible</button>
                    <button class="btn-secondary" onclick="showScreen('hopeReminders')">Hope Reminders</button>
                    <button class="btn-secondary" onclick="showScreen('journalSpace')">Journal & Pray</button>
                </div>
            </div>
        </div>

        <!-- Psalm Therapy Screen -->
        <div class="screen" id="psalmTherapy">
            <div class="header">
                <h1>Your Psalm for Today</h1>
                <p>David knew the wilderness. His prayers can be yours.</p>
            </div>
            
            <div class="content-section">
                <div class="psalm-display" id="psalmDisplay">
                    <h3>A Prayer for Your Heart</h3>
                    <div class="psalm-text">
                        "Why, my soul, are you downcast? Why so disturbed within me? Put your hope in God, for I will yet praise him, my Savior and my God."
                    </div>
                    <div class="psalm-reference">Psalm 42:11</div>
                </div>

                <div class="mood-section">
                    <h3>Reflect</h3>
                    <p>David experienced every emotion you're feeling. He didn't hide them from God - he brought them all, raw and honest.</p>
                    <br>
                    <p>What would you like to tell God right now, with David's honesty?</p>
                    <br>
                    <textarea class="journal-area" placeholder="Pour out your heart here..."></textarea>
                </div>

                <button class="btn" onclick="getNewPsalm()">Another Psalm</button>
            </div>
        </div>

        <!-- Wilderness Stories Screen -->
        <div class="screen" id="wildernessStories">
            <div class="header">
                <h1>You're Not Alone</h1>
                <p>God's greatest servants knew the wilderness</p>
            </div>
            
            <div class="content-section">
                <div class="story-card" onclick="expandStory('elijah', this)">
                    <h3>Elijah Under the Broom Tree</h3>
                    <p>When the mighty prophet wanted to die, God sent angels with bread and water...</p>
                    <div class="story-expanded" id="story-elijah">
                        After his greatest victory, Elijah ran in fear and prayed to die. God didn't scold him. Instead, He provided rest, food, and water. Then, in a gentle whisper, God reminded Elijah he wasn't alone. Sometimes the bravest thing is to accept care.
                    </div>
                </div>

                <div class="story-card" onclick="expandStory('david', this)">
                    <h3>David in the Cave</h3>
                    <p>Hiding from Saul, feeling abandoned, yet writing psalms of hope...</p>
                    <div class="story-expanded" id="story-david">
                        In the caves of Adullam and En Gedi, David poured out his complaints to God. He didn't pretend to be strong. These 'cave psalms' became Scripture, showing us that our honest cries in darkness become lights for others.
                    </div>
                </div>

                <div class="story-card" onclick="expandStory('jesus', this)">
                    <h3>Jesus in the Wilderness</h3>
                    <p>40 days of hunger, temptation, and spiritual warfare before ministry began...</p>
                    <div class="story-expanded" id="story-jesus">
                        Before His ministry began, Jesus spent 40 days in the wilderness. Hungry, alone, tested. The Son of God knew wilderness. He understands yours. He emerged in the power of the Spirit, and so will you.
                    </div>
                </div>

                <div class="story-card" onclick="expandStory('paul', this)">
                    <h3>Paul's Thorn</h3>
                    <p>When healing didn't come, grace proved sufficient...</p>
                    <div class="story-expanded" id="story-paul">
                        Three times Paul begged God to remove his thorn. The answer was no, but with it came a promise: 'My grace is sufficient.' Sometimes healing looks different than we expect.
                    </div>
                </div>

                <div class="story-card" onclick="expandStory('job', this)">
                    <h3>Job's Dark Night</h3>
                    <p>Everything lost, sitting in ashes, yet finding God in the whirlwind...</p>
                    <div class="story-expanded" id="story-job">
                        Job lost everything and sat in ashes, scraping his sores. His friends failed him. His wife told him to curse God. But in the whirlwind, God came. Not with answers, but with Presence. It was enough.
                    </div>
                </div>
            </div>
        </div>

        <!-- Simple Disciplines Screen -->
        <div class="screen" id="simpleDisciplines">
            <div class="header">
                <h1>When Faith Feels Impossible</h1>
                <p>Gentle practices for the wilderness season</p>
            </div>
            
            <div class="content-section">
                <div class="discipline-item">
                    <h4>The One-Word Prayer</h4>
                    <p>When you can't find words, just whisper:</p>
                    <div class="discipline-practice">
                        "Help"<br>
                        "Please"<br>
                        "Jesus"<br>
                        <small>That's enough. He hears.</small>
                    </div>
                </div>

                <div class="discipline-item">
                    <h4>The 3-Breath Practice</h4>
                    <p>When anxiety overwhelms:</p>
                    <div class="discipline-practice">
                        Breathe in: "Lord..."<br>
                        Hold: "I need..."<br>
                        Breathe out: "You."<br>
                        <small>Repeat until peace comes.</small>
                    </div>
                </div>

                <div class="discipline-item">
                    <h4>The Morning Anchor</h4>
                    <p>Before the day's weight descends:</p>
                    <div class="discipline-practice">
                        Place your hand on your heart.<br>
                        Say: "I am still loved today."<br>
                        Nothing you do changes this.<br>
                        <small>Start here, always.</small>
                    </div>
                </div>

                <div class="discipline-item">
                    <h4>The Evening Release</h4>
                    <p>When sleep won't come:</p>
                    <div class="discipline-practice">
                        Name three things you carried today.<br>
                        Imagine placing them in God's hands.<br>
                        Say: "I'll pick these up tomorrow if You want me to."<br>
                        <small>Rest is also holy.</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Hope Reminders Screen -->
        <div class="screen" id="hopeReminders">
            <div class="header">
                <h1>Resurrection Is Coming</h1>
                <p>Every wilderness has an end</p>
            </div>
            
            <div class="content-section">
                <div class="psalm-display">
                    <h3>Remember: Weeping to Joy</h3>
                    <div class="psalm-text">
                        "Weeping may stay for the night, but rejoicing comes in the morning."
                    </div>
                    <div class="psalm-reference">Psalm 30:5</div>
                </div>

                <div class="mood-section">
                    <h3>God's Track Record</h3>
                    <ul style="text-align: left; padding-left: 20px; line-height: 2;">
                        <li>Joseph: From prison to palace</li>
                        <li>Moses: From fugitive to deliverer</li>
                        <li>Hannah: From barrenness to blessing</li>
                        <li>Job: From ashes to restoration</li>
                        <li>Peter: From denial to apostle</li>
                        <li>Paul: From persecutor to preacher</li>
                    </ul>
                    <br>
                    <p><strong>Your story isn't finished.</strong></p>
                </div>

                <div class="discipline-item">
                    <h4>A Promise to Hold</h4>
                    <div class="discipline-practice">
                        "The God who brought you to this wilderness<br>
                        is the same God who will lead you through it.<br>
                        He has not forgotten you.<br>
                        He cannot abandon you.<br>
                        Morning is coming."
                    </div>
                </div>
            </div>
        </div>

        <!-- Journal Space Screen -->
        <div class="screen" id="journalSpace">
            <div class="header">
                <h1>Your Sacred Space</h1>
                <p>Pour out your heart like water</p>
            </div>
            
            <div class="content-section">
                <div class="mood-section">
                    <h3>Today's Reflection</h3>
                    <p>What do you need to tell God? What do you need to remember?</p>
                    <br>
                    <textarea class="journal-area" id="journalText" style="min-height: 300px;" placeholder="Write freely here. No judgment. No perfection needed. Just honesty..."></textarea>
                    <br>
                    <button class="btn-secondary" onclick="saveJournal()">Save to Heart</button>
                </div>

                <div class="discipline-item">
                    <h4>A Closing Prayer</h4>
                    <div class="discipline-practice">
                        Lord,<br>
                        I don't understand this wilderness,<br>
                        but I trust the One who walks with me.<br>
                        Give me bread for today,<br>
                        courage for tomorrow,<br>
                        and hope that dawn is coming.<br>
                        Amen.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <button class="nav-btn" onclick="showScreen('mainMenu')">🏠 Home</button>
        <button class="nav-btn" onclick="showInfo()">ℹ️ Info</button>
        <button class="nav-btn" onclick="showAbout()">❤️ About</button>
    </div>

    <!-- Info Modal -->
    <div class="modal" id="infoModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>About Wilderness Journey</h2>
                <button class="close-modal" onclick="closeModal('infoModal')">&times;</button>
            </div>
            
            <div class="info-section">
                <h3>What is Wilderness Journey?</h3>
                <p>A biblical companion for depression and spiritual darkness. This app connects your current emotional state with the honest prayers of the Psalms, wilderness stories from Scripture, and gentle spiritual practices for when faith feels impossible.</p>
            </div>

            <div class="info-section">
                <h3>How to Use This App</h3>
                <ul>
                    <li>Start by selecting your current emotional state</li>
                    <li>Explore psalms that match your feelings</li>
                    <li>Read stories of biblical figures who faced similar struggles</li>
                    <li>Try simple spiritual practices designed for difficult days</li>
                    <li>Use the journal to process your thoughts and prayers</li>
                    <li>Return daily for new encouragement and reminders of hope</li>
                </ul>
            </div>

            <div class="info-section">
                <h3>Installing on Your Phone</h3>
                <p><strong>iPhone:</strong> Tap the share button in Safari, then "Add to Home Screen"</p>
                <p><strong>Android:</strong> Tap the menu (3 dots) in Chrome, then "Add to Home Screen"</p>
            </div>

            <div class="crisis-note">
                <strong>Crisis Support:</strong><br>
                If you are in crisis, please contact your local helpline for immediate support.
            </div>
        </div>
    </div>

    <!-- About Modal -->
    <div class="modal" id="aboutModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Depths to Heights</h2>
                <button class="close-modal" onclick="closeModal('aboutModal')">&times;</button>
            </div>
            
            <div class="info-section">
                <h3>Our Mission</h3>
                <p>Creating tools that meet people in their darkest valleys and walk with them toward hope, healing, and restoration.</p>
            </div>

            <div class="info-section">
                <h3>Created By</h3>
                <p><strong>Made by Justin</strong><br>
                Depths to Heights<br>
                <a href="https://depthstoheights.org" style="color: #7c9885;">depthstoheights.org</a><br>
                <a href="mailto:depthstoheights@gmail.com" style="color: #7c9885;">depthstoheights@gmail.com</a></p>
            </div>

            <div class="donation-section">
                <h3>Support This Work</h3>
                <p>If this app encouraged you, consider supporting the work of Depths to Heights. Your donation helps us create more free, life-giving tools.</p>
                <a href="#" class="donation-btn" onclick="alert('PayPal donation link will go here')">Donate via PayPal</a>
            </div>

            <div class="crisis-note">
                <strong>Remember:</strong><br>
                If you are in crisis, please contact your local helpline for immediate support.
            </div>
        </div>
    </div>

    <script>
        // Audio Management
        let audioContext;
        let audioBuffer;
        let audioSource;
        let isPlaying = false;

        // Create gentle background audio
        function initAudio() {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            // Create a simple, calming tone
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(174, audioContext.currentTime); // Low, calming frequency
            
            gainNode.gain.setValueAtTime(0.05, audioContext.currentTime); // Very quiet
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.start();
            audioSource = oscillator;
            isPlaying = true;
        }

        function toggleAudio() {
            const icon = document.getElementById('audioIcon');
            const toggle = document.getElementById('audioToggle');
            
            if (!audioContext) {
                initAudio();
                icon.textContent = '🔊';
                toggle.classList.remove('muted');
            } else if (isPlaying) {
                audioContext.suspend();
                isPlaying = false;
                icon.textContent = '🔇';
                toggle.classList.add('muted');
            } else {
                audioContext.resume();
                isPlaying = true;
                icon.textContent = '🔊';
                toggle.classList.remove('muted');
            }
        }

        // Start Journey Function
        function startJourney() {
            showScreen('mainMenu');
        }

        // Screen Navigation
        function showScreen(screenId) {
            // Play transition sound
            playTransitionSound();
            
            // Hide all screens
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            // Show selected screen
            setTimeout(() => {
                document.getElementById(screenId).classList.add('active');
            }, 300);
        }

        // Mood Selection
        let selectedMood = 'darkness';

        function selectMood(mood, element) {
            selectedMood = mood;
            
            // Update UI
            document.querySelectorAll('.mood-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            element.classList.add('selected');
            
            // Play feedback sound
            playClickSound();
        }

        // Psalm Database - More extensive
        const psalms = {
            darkness: [
                { text: "Out of the depths I cry to you, Lord; Lord, hear my voice. Let your ears be attentive to my cry for mercy.", reference: "Psalm 130:1-2" },
                { text: "How long, Lord? Will you forget me forever? How long will you hide your face from me?", reference: "Psalm 13:1" },
                { text: "My God, my God, why have you forsaken me? Why are you so far from saving me?", reference: "Psalm 22:1" },
                { text: "Save me, O God, for the waters have come up to my neck. I sink in the miry depths, where there is no foothold.", reference: "Psalm 69:1-2" },
                { text: "I am worn out calling for help; my throat is parched. My eyes fail, looking for my God.", reference: "Psalm 69:3" }
            ],
            lost: [
                { text: "Send me your light and your faithful care, let them lead me; let them bring me to your holy mountain.", reference: "Psalm 43:3" },
                { text: "You are my lamp, Lord; the Lord turns my darkness into light.", reference: "2 Samuel 22:29" },
                { text: "Show me your ways, Lord, teach me your paths. Guide me in your truth.", reference: "Psalm 25:4-5" },
                { text: "The Lord is my light and my salvation—whom shall I fear?", reference: "Psalm 27:1" },
                { text: "For you have delivered me from death and my feet from stumbling, that I may walk before God in the light of life.", reference: "Psalm 56:13" }
            ],
            weary: [
                { text: "Come to me, all you who are weary and burdened, and I will give you rest.", reference: "Matthew 11:28" },
                { text: "He gives strength to the weary and increases the power of the weak.", reference: "Isaiah 40:29" },
                { text: "I am worn out from my groaning. All night long I flood my bed with weeping.", reference: "Psalm 6:6" },
                { text: "My soul is weary with sorrow; strengthen me according to your word.", reference: "Psalm 119:28" },
                { text: "Even youths grow tired and weary, and young men stumble and fall; but those who hope in the Lord will renew their strength.", reference: "Isaiah 40:30-31" }
            ],
            numb: [
                { text: "Why, my soul, are you downcast? Why so disturbed within me? Put your hope in God.", reference: "Psalm 42:11" },
                { text: "The Lord is close to the brokenhearted and saves those who are crushed in spirit.", reference: "Psalm 34:18" },
                { text: "My heart is blighted and withered like grass; I forget to eat my food.", reference: "Psalm 102:4" },
                { text: "I have become like broken pottery. I am forgotten as though I were dead.", reference: "Psalm 31:12" },
                { text: "Restore to me the joy of your salvation and grant me a willing spirit, to sustain me.", reference: "Psalm 51:12" }
            ]
        };

        let psalmIndex = 0;

        function getNewPsalm() {
            const mood = selectedMood || 'darkness';
            const moodPsalms = psalms[mood];
            
            // Cycle through psalms instead of random
            psalmIndex = (psalmIndex + 1) % moodPsalms.length;
            const currentPsalm = moodPsalms[psalmIndex];
            
            const display = document.getElementById('psalmDisplay');
            display.innerHTML = `
                <h3>A Prayer for Your Heart</h3>
                <div class="psalm-text">${currentPsalm.text}</div>
                <div class="psalm-reference">${currentPsalm.reference}</div>
            `;
            
            playTransitionSound();
        }

        // Story Expansion
        function expandStory(storyId, element) {
            const storyDiv = document.getElementById('story-' + storyId);
            
            // Toggle the story expansion
            if (storyDiv.classList.contains('active')) {
                storyDiv.classList.remove('active');
            } else {
                // Close all other stories
                document.querySelectorAll('.story-expanded').forEach(story => {
                    story.classList.remove('active');
                });
                // Open this story
                storyDiv.classList.add('active');
            }
            
            playClickSound();
        }

        // Journal Functions
        function saveJournal() {
            const journalText = document.getElementById('journalText').value;
            if (journalText) {
                // Save to localStorage
                const journals = JSON.parse(localStorage.getItem('wildernessJournals') || '[]');
                journals.push({
                    text: journalText,
                    date: new Date().toISOString()
                });
                localStorage.setItem('wildernessJournals', JSON.stringify(journals));
                
                alert("Your words have been held in this sacred space. Return anytime to continue your conversation with God.");
                playTransitionSound();
            }
        }

        // Modal Functions
        function showInfo() {
            document.getElementById('infoModal').classList.add('active');
        }

        function showAbout() {
            document.getElementById('aboutModal').classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Sound Effects
        function playTransitionSound() {
            if (!audioContext || !isPlaying) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(220, audioContext.currentTime + 0.3);
            
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.3);
        }

        function playClickSound() {
            if (!audioContext || !isPlaying) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(600, audioContext.currentTime);
            
            gainNode.gain.setValueAtTime(0.05, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.1);
        }

        // Initialize on first user interaction
        document.addEventListener('click', function initAudioContext() {
            if (!audioContext) {
                // Remove this event listener after first click
            }
        }, { once: true });

        // Close modals on background click
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            });
        });
    </script>
</body>
</html>